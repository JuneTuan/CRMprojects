# 产品管理功能需求文档 (PRD)

## 1. 功能概述

产品管理是JunLite CRM系统的核心业务功能模块，负责管理产品信息、产品分类、产品库存等核心数据。通过产品管理功能，企业可以高效管理产品目录，控制产品库存，提供准确的产品信息给客户。

## 2. 用户故事

### 2.1 管理员查看产品列表
**作为** 管理员  
**我想要** 查看所有产品列表  
**以便** 了解产品情况和库存状态

### 2.2 管理员创建产品
**作为** 管理员  
**我想要** 添加新产品  
**以便** 扩充产品目录

### 2.3 管理员编辑产品
**作为** 管理员  
**我想要** 修改产品信息  
**以便** 保持产品信息的准确性

### 2.4 管理员删除产品
**作为** 管理员  
**我想要** 删除无效产品  
**以便** 维护产品目录的质量

### 2.5 管理员管理产品分类
**作为** 管理员  
**我想要** 创建和管理产品分类  
**以便** 更好地组织产品

### 2.6 管理员调整产品库存
**作为** 管理员  
**我想要** 手动调整产品库存  
**以便** 处理库存盘点和调整

### 2.7 客户浏览产品
**作为** 客户  
**我想要** 浏览产品列表  
**以便** 查看可购买的产品

### 2.8 客户查看产品详情
**作为** 客户  
**我想要** 查看产品的详细信息  
**以便** 了解产品详情并决定购买

### 2.9 客户搜索产品
**作为** 客户  
**我想要** 按名称搜索产品  
**以便** 快速找到需要的产品

### 2.10 客户按分类筛选产品
**作为** 客户  
**我想要** 按分类筛选产品  
**以便** 查看特定分类的产品

## 3. 业务流程

### 3.1 产品创建流程

```
填写产品信息 → 上传产品图片 → 选择产品分类 → 设置价格和库存 → 验证数据 → 保存产品 → 返回产品信息
```

#### 3.1.1 产品信息验证
- 产品名称不能为空
- 产品描述不能为空
- 产品价格必须大于0
- 产品库存必须大于等于0
- 产品分类必须存在

#### 3.1.2 产品图片处理
- 支持上传产品图片
- 图片格式：jpg, png, jpeg
- 图片大小限制：5MB
- 自动压缩和优化图片

#### 3.1.3 产品编码生成
- 格式：PROD_时间戳
- 示例：PROD_1708329600000
- 确保唯一性

### 3.2 产品更新流程

```
选择产品 → 修改产品信息 → 上传新图片（可选） → 验证数据 → 更新产品 → 记录更新时间 → 返回结果
```

#### 3.2.1 可更新字段
- 产品名称
- 产品描述
- 产品图片
- 产品分类
- 产品价格
- 产品库存
- 产品状态

#### 3.2.2 不可更新字段
- 产品编码（productCode）
- 产品ID（productId）
- 创建时间（createdAt）

### 3.3 产品删除流程

```
选择产品 → 检查关联数据 → 软删除或硬删除 → 返回结果
```

#### 3.3.1 删除条件
- 产品不能有关联的订单
- 产品不能有关联的奖品
- 建议使用软删除

#### 3.3.2 删除策略
- 软删除：标记为已删除，保留数据
- 硬删除：物理删除数据

### 3.4 库存管理流程

#### 3.4.1 库存增加
```
管理员发起增加库存 → 验证产品存在 → 增加产品库存 → 记录库存变动 → 返回结果
```

#### 3.4.2 库存减少
```
订单创建或管理员发起 → 验证产品存在和库存充足 → 减少产品库存 → 记录库存变动 → 返回结果
```

#### 3.4.3 库存预警
- 库存低于阈值时预警
- 库存为0时提示缺货
- 支持设置预警阈值

### 3.5 产品分类管理流程

```
创建分类 → 设置分类名称和描述 → 设置分类排序 → 保存分类 → 返回分类信息
```

#### 3.5.1 分类层级
- 支持多级分类
- 每个分类可以包含子分类
- 分类层级深度限制为3级

#### 3.5.2 分类排序
- 支持设置分类排序
- 按排序号显示分类
- 同级分类按排序号排序

## 4. 功能需求

### 4.1 管理端功能

#### 4.1.1 产品列表
- 分页展示产品列表
- 支持按产品名称搜索
- 支持按分类筛选
- 支持按状态筛选（上架/下架）
- 显示产品基本信息：编码、名称、分类、价格、库存、状态
- 支持按创建时间排序
- 显示产品总数

#### 4.1.2 产品详情
- 显示产品完整信息
- 显示产品图片
- 显示产品分类信息
- 显示库存信息
- 显示创建时间和更新时间

#### 4.1.3 创建产品
- 填写产品基本信息
- 上传产品图片
- 选择产品分类
- 设置产品价格
- 设置产品库存
- 设置产品状态
- 验证数据有效性

#### 4.1.4 编辑产品
- 修改产品基本信息
- 上传新产品图片
- 修改产品分类
- 修改产品价格
- 修改产品库存
- 修改产品状态
- 验证数据有效性

#### 4.1.5 删除产品
- 删除产品
- 确认删除操作
- 提示删除影响

#### 4.1.6 库存管理
- 查看产品库存
- 手动增加库存
- 手动减少库存
- 查看库存预警
- 设置库存预警阈值

#### 4.1.7 产品分类管理
- 查看分类列表
- 创建分类
- 编辑分类
- 删除分类
- 设置分类排序
- 设置分类层级

#### 4.1.8 产品统计
- 产品总数统计
- 上架产品数
- 下架产品数
- 库存预警产品数
- 产品分类统计

### 4.2 用户端功能

#### 4.2.1 产品列表
- 分页展示产品列表
- 支持按产品名称搜索
- 支持按分类筛选
- 只显示上架产品
- 显示产品基本信息：名称、图片、价格、库存
- 支持按价格排序
- 支持按销量排序

#### 4.2.2 产品详情
- 显示产品完整信息
- 显示产品大图
- 显示产品描述
- 显示产品价格
- 显示产品库存
- 显示产品分类
- 添加到购物车
- 立即购买

#### 4.2.3 产品分类
- 查看分类列表
- 按分类查看产品
- 显示分类层级
- 显示分类下的产品数量

#### 4.2.4 产品搜索
- 按产品名称搜索
- 显示搜索结果
- 高亮搜索关键词
- 支持模糊搜索

## 5. 技术实现

### 5.1 数据模型

#### 5.1.1 产品 (Product)
```typescript
{
  productId: number               // 产品ID（主键）
  productCode: string             // 产品编码（唯一）
  productName: string             // 产品名称
  description: string              // 产品描述
  imageUrl: string                // 产品图片URL
  price: number                   // 产品价格
  stock: number                   // 产品库存
  categoryId: number              // 分类ID（外键）
  status: string                  // 状态：上架/下架
  sales: number                   // 销量
  createdAt: Date                 // 创建时间
  updatedAt: Date                 // 更新时间
}
```

#### 5.1.2 产品分类 (ProductCategory)
```typescript
{
  categoryId: number              // 分类ID（主键）
  categoryName: string            // 分类名称
  description: string              // 分类描述
  parentId: number                // 父分类ID（外键，可选）
  sortOrder: number               // 排序号
  createdAt: Date                 // 创建时间
  updatedAt: Date                 // 更新时间
}
```

### 5.2 核心算法

#### 5.2.1 产品编码生成
```typescript
function generateProductCode(): string {
  const timestamp = Date.now();
  return `PROD_${timestamp}`;
}
```

#### 5.2.2 库存增加
```typescript
async function increaseStock(productId: number, quantity: number, reason: string) {
  const product = await productRepository.findOne({ where: { productId } });
  if (!product) {
    throw new NotFoundException('产品不存在');
  }
  
  product.stock += quantity;
  await productRepository.save(product);
  
  return product;
}
```

#### 5.2.3 库存减少
```typescript
async function decreaseStock(productId: number, quantity: number, reason: string) {
  const product = await productRepository.findOne({ where: { productId } });
  if (!product) {
    throw new NotFoundException('产品不存在');
  }
  
  if (product.stock < quantity) {
    throw new BadRequestException('库存不足');
  }
  
  product.stock -= quantity;
  await productRepository.save(product);
  
  return product;
}
```

#### 5.2.4 库存预警检查
```typescript
async function checkStockWarning(productId: number, threshold: number = 10): boolean {
  const product = await productRepository.findOne({ where: { productId } });
  if (!product) {
    throw new NotFoundException('产品不存在');
  }
  
  return product.stock <= threshold;
}
```

#### 5.2.5 分类树构建
```typescript
async function buildCategoryTree(): Promise<CategoryTree[]> {
  const categories = await categoryRepository.find({
    order: { sortOrder: 'ASC' },
  });
  
  const categoryMap = new Map<number, CategoryTree>();
  const rootCategories: CategoryTree[] = [];
  
  categories.forEach(category => {
    categoryMap.set(category.categoryId, {
      ...category,
      children: [],
    });
  });
  
  categories.forEach(category => {
    const node = categoryMap.get(category.categoryId)!;
    if (category.parentId) {
      const parent = categoryMap.get(category.parentId);
      if (parent) {
        parent.children.push(node);
      }
    } else {
      rootCategories.push(node);
    }
  });
  
  return rootCategories;
}
```

### 5.3 接口设计

#### 5.3.1 管理端接口

**GET /products**
- 获取产品列表
- 查询参数：page, pageSize, search, categoryId, status
- 返回：产品列表、总数、分页信息

**GET /products/:id**
- 获取产品详情
- 返回：产品完整信息

**POST /products**
- 创建产品
- 请求体：产品信息
- 返回：创建的产品信息

**PUT /products/:id**
- 更新产品信息
- 请求体：更新的产品信息
- 返回：更新后的产品信息

**DELETE /products/:id**
- 删除产品
- 返回：删除结果

**POST /products/:id/increase-stock**
- 增加库存
- 请求体：{ quantity, reason }
- 返回：更新后的产品信息

**POST /products/:id/decrease-stock**
- 减少库存
- 请求体：{ quantity, reason }
- 返回：更新后的产品信息

**GET /products/categories**
- 获取分类列表
- 返回：分类列表

**GET /products/categories/tree**
- 获取分类树
- 返回：分类树结构

**POST /products/categories**
- 创建分类
- 请求体：分类信息
- 返回：创建的分类信息

**PUT /products/categories/:id**
- 更新分类信息
- 请求体：更新的分类信息
- 返回：更新后的分类信息

**DELETE /products/categories/:id**
- 删除分类
- 返回：删除结果

**GET /statistics/products**
- 获取产品统计数据
- 返回：产品总数、上架数、库存预警等

#### 5.3.2 用户端接口

**GET /h5/products**
- 获取产品列表
- 查询参数：page, pageSize, search, categoryId, sort
- 返回：产品列表、总数

**GET /h5/products/:id**
- 获取产品详情
- 返回：产品完整信息

**GET /h5/products/categories**
- 获取分类列表
- 返回：分类列表

**GET /h5/products/categories/:id/products**
- 获取分类下的产品
- 查询参数：page, pageSize
- 返回：产品列表、总数

## 6. 业务规则

### 6.1 产品管理规则

1. **产品编码**
   - 产品编码必须唯一
   - 自动生成，不可修改
   - 格式：PROD_时间戳

2. **产品价格**
   - 产品价格必须大于0
   - 价格保留两位小数
   - 支持修改价格

3. **产品库存**
   - 产品库存必须大于等于0
   - 库存为0时不能下单
   - 支持手动调整库存

4. **产品状态**
   - 产品状态：上架/下架
   - 下架产品不能购买
   - 支持批量上下架

### 6.2 产品分类规则

1. **分类层级**
   - 支持多级分类
   - 层级深度限制为3级
   - 每个分类只能有一个父分类

2. **分类排序**
   - 支持设置分类排序
   - 按排序号显示
   - 同级分类按排序号排序

3. **分类删除**
   - 删除分类前检查是否有产品
   - 删除分类前检查是否有子分类
   - 建议使用软删除

### 6.3 库存管理规则

1. **库存预警**
   - 库存低于阈值时预警
   - 默认预警阈值为10
   - 支持自定义预警阈值

2. **库存变动**
   - 订单创建时扣减库存
   - 订单取消时恢复库存
   - 支持手动调整库存

3. **库存同步**
   - 库存实时更新
   - 防止超卖
   - 使用数据库事务保证一致性

## 7. 用户体验

### 7.1 管理端体验

1. **列表展示**
   - 清晰的产品列表
   - 支持快速搜索
   - 分页加载优化

2. **信息查看**
   - 产品详情页展示完整信息
   - 产品图片清晰
   - 库存信息明显

3. **操作便捷**
   - 一键创建产品
   - 快速编辑产品
   - 便捷的库存管理

### 7.2 用户端体验

1. **产品浏览**
   - 清晰的产品列表
   - 产品图片美观
   - 价格信息明显

2. **产品详情**
   - 详细的产品描述
   - 多角度产品图片
   - 库存信息可见

3. **搜索筛选**
   - 快速搜索产品
   - 按分类筛选
   - 排序功能

## 8. 统计分析

### 8.1 关键指标

1. **产品指标**
   - 产品总数
   - 上架产品数
   - 下架产品数
   - 库存预警产品数

2. **销售指标**
   - 产品销量
   - 产品销售额
   - 热销产品排行

3. **库存指标**
   - 库存总额
   - 库存周转率
   - 缺货产品数

### 8.2 报表功能

1. **产品报表**
   - 产品增长趋势
   - 产品销售分析
   - 产品库存分析

2. **分类报表**
   - 分类销售分析
   - 分类库存分析
   - 分类产品分布

## 9. 后续优化

### 9.1 功能增强

1. **产品规格**
   - 支持多规格产品
   - 规格价格设置
   - 规格库存管理

2. **产品标签**
   - 为产品打标签
   - 基于标签筛选产品
   - 标签统计分析

3. **产品推荐**
   - 相关产品推荐
   - 热销产品推荐
   - 新品推荐

### 9.2 性能优化

1. **缓存优化**
   - 产品信息缓存
   - 分类信息缓存
   - 库存信息缓存

2. **查询优化**
   - 索引优化
   - 查询语句优化
   - 分页查询优化

## 10. 版本规划

### 10.1 V1.0（当前版本）
- ✅ 产品基本信息管理
- ✅ 产品分类管理
- ✅ 产品库存管理
- ✅ 产品图片上传
- ✅ 基础统计功能

### 10.2 V1.1（规划中）
- 🔄 产品规格功能
- 🔄 产品标签功能
- 🔄 产品推荐功能
- 🔄 高级统计分析

### 10.3 V2.0（未来规划）
- ⏳ AI产品分析
- ⏳ 智能定价
- ⏳ 库存预测
- ⏳ 自动补货

---

**文档版本**: 1.0  
**最后更新**: 2026-02-19  
**维护人**: JunLite CRM Team