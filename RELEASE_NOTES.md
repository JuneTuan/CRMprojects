# JunLite CRM v5.2 发布说明

## 🎉 版本发布

JunLite CRM v5.2 版本已准备就绪，可以部署到生产环境！

## 📦 版本信息

- **版本号**: v5.2
- **发布日期**: 2026-02-26
- **Git标签**: v5.2
- **分支**: main
- **状态**: ✅ 生产就绪

## 🎯 系统架构

```
JunLite CRM
├── 后端服务 (NestJS + TypeORM + MySQL)
│   ├── 端口: 3001
│   ├── 数据库: MySQL 8.0+
│   └── 进程管理: PM2
├── 管理后台 (Vue 3 + Vite + Element Plus)
│   ├── 端口: 5173 (开发) / 80 (生产)
│   └── 反向代理: Nginx
└── H5前端 (Uni-app + Vue 3)
    ├── 端口: 5174 (开发) / 80 (生产)
    └── 反向代理: Nginx
```

## ✨ 核心功能

### 1. 会员等级系统
- ✅ 自动升级：根据消费额自动调整会员等级
- ✅ 手动调整：管理员可以手动调整客户等级
- ✅ 等级配置：支持自定义等级名称、图标、权益
- ✅ 变更日志：完整追踪等级变更历史

### 2. 活动游戏系统
- ✅ 游戏类型：大转盘、老虎机、刮刮乐、盲盒、九宫格
- ✅ 奖品管理：支持积分、券、实物奖品
- ✅ 概率配置：灵活配置中奖概率
- ✅ 免费次数：支持设置每日免费抽奖次数

### 3. 产品管理
- ✅ CRUD操作：创建、读取、更新、删除产品
- ✅ 库存管理：实时库存跟踪
- ✅ 分类管理：产品分类和筛选

### 4. 订单管理
- ✅ 订单创建：支持多产品订单
- ✅ 状态管理：待付款、已付款、已发货、已完成等
- ✅ 会员计算：订单完成后自动计算消费额和积分

### 5. 客户管理
- ✅ 客户信息：完整的客户档案
- ✅ 积分管理：积分获取和使用记录
- ✅ 消费统计：累计消费额统计

## 📋 部署清单

### 前置条件

- [ ] 服务器环境：Linux (Ubuntu 20.04+ 或 CentOS 7+)
- [ ] Node.js: >= 18.0.0
- [ ] MySQL: >= 8.0
- [ ] Nginx: >= 1.18
- [ ] PM2: >= 5.0

### 部署文件

- [ ] `DEPLOYMENT.md` - 详细部署指南
- [ ] `DEPLOYMENT_PACKAGE_README.md` - 部署包说明
- [ ] `deploy.sh` - 自动化部署脚本
- [ ] `server/.env.production` - 后端环境配置
- [ ] `admin-web/.env.production` - 管理后台配置
- [ ] `customerH5/.env.production` - H5前端配置

### 配置修改

- [ ] 修改数据库连接信息（server/.env）
- [ ] 修改JWT密钥（server/.env）
- [ ] 修改API地址（admin-web/.env）
- [ ] 修改API地址（customerH5/.env）

## 🚀 快速部署

### 方式一：使用自动化脚本（推荐）

```bash
# 1. 检查环境
./deploy.sh

# 2. 脚本会自动完成：
#    - 检查Node.js和npm版本
#    - 验证Git状态
#    - 构建所有项目
#    - 创建部署包
#    - 生成部署脚本

# 3. 上传到服务器
scp crm-r1.0.0-deployment.tar.gz user@server:/tmp/

# 4. 在服务器上部署
ssh user@server
cd /opt
tar -xzf /tmp/crm-r1.0.0-deployment.tar.gz
cd crm-r1.0.0
./deploy.sh
```

### 方式二：手动部署

参考 `DEPLOYMENT.md` 中的详细步骤进行手动部署。

## 🌐 访问地址

部署完成后，通过以下地址访问系统：

- **管理后台**: http://admin.your-domain.com
- **H5前端**: http://h5.your-domain.com
- **后端API**: http://your-server-ip:3001

## 🔐 默认账号

**管理员账号**：
- 用户名: `admin`
- 密码: `admin123`

**⚠️ 重要提示：首次登录后请立即修改默认密码！**

## 📊 测试覆盖

R1.0.0 版本已完成以下测试：

### 功能测试
- ✅ 产品管理功能（列表、创建、编辑、删除）
- ✅ 订单管理功能（列表、创建、状态更新）
- ✅ 活动管理功能（列表、创建、游戏配置）
- ✅ 会员等级自动升级功能
- ✅ 会员等级手动调整功能
- ✅ H5用户注册和登录
- ✅ H5活动页面和抽奖功能
- ✅ H5订单查询功能
- ✅ 抽奖记录查询功能

### 回归测试
- ✅ 产品管理回归测试
- ✅ 订单管理回归测试
- ✅ 活动管理回归测试
- ✅ 会员等级系统回归测试
- ✅ 活动游戏功能回归测试

## 🔧 技术改进

### 代码质量
- ✅ 修复decimal类型转换问题
- ✅ 优化数据库查询性能
- ✅ 完善错误处理机制
- ✅ 添加详细的日志记录

### 部署优化
- ✅ 添加自动化部署脚本
- ✅ 提供完整的环境配置模板
- ✅ 编写详细的部署文档
- ✅ 支持一键部署

## 📞 技术支持

### 文档资源
- **部署指南**: [DEPLOYMENT.md](./DEPLOYMENT.md)
- **部署包说明**: [DEPLOYMENT_PACKAGE_README.md](./DEPLOYMENT_PACKAGE_README.md)
- **项目说明**: [README.md](./README.md)

### 问题反馈
- 提交Issue到代码仓库
- 联系技术支持团队

## 🔄 后续计划

### R1.3 计划
- 修复消费额累加问题
- 优化抽奖算法性能
- 添加数据导出功能

### R2.0 计划
- 添加报表统计功能
- 实现消息通知系统
- 优化移动端体验

## 📝 更新日志

### v5.2 (2026-02-26)

**新增功能**：
- 增加审计日志功能：记录所有客户登录H5以及用户登录adminweb的动作，包括登录时间、IP地址、操作类型等信息
- 管理后台审计日志查看页面：支持查看、搜索和筛选审计日志记录
- 审计日志统计功能：支持统计不同状态的审计日志数量

**bug修复**：
- 修复审计日志没有正确记录登录用户台账的问题，特别是H5登录记录缺失
- 解决H5登录失败问题
- 解决登录后仍显示登录页面的问题
- 修复审计日志记录失败导致的500错误
- 解决用户认证失败（用户名或密码错误）问题
- 修复活动页面和"我的中心"页面会员等级显示错误问题
- 解决adminweb审计记录查看页面为空的问题
- 修复搜索失败状态时找不到结果的问题

**技术改进**：
- 优化审计日志记录逻辑，确保登录成功和失败都能正确记录
- 修复H5控制器中审计日志调用参数缺失的问题
- 修复数据库字段名错误，确保用户创建操作正常执行
- 修复前端axios配置和响应处理逻辑
- 确保状态值在整个系统中的一致性
- 优化数据库查询性能，移除不必要的关联查询

### R1.2.0 (2026-02-19)

**品牌更新**：
- 将系统名称从"CRM System"更新为"JunLite CRM"
- 更新所有文档和配置文件中的系统名称
- 统一品牌标识，提升系统专业形象

**版本更新**：
- 更新后端版本号：R1.1.0 → R1.2.0
- 更新管理后台版本号：R1.1.0 → R1.2.0
- 更新H5前端版本号：R1.1.0 → R1.2.0
- 更新部署文档中的版本信息

### R1.1.0 (2026-02-19)

**代码优化**：
- 清理所有临时脚本和迁移文件
- 删除不用的数据库脚本（add-active-game-type.sql, add-activity-type.sql等）
- 删除不用的TypeScript迁移脚本（run-migration.ts, run-prize-type-migration.ts等）
- 删除不用的JavaScript脚本（add-prizes-activity7.js, add-scratch-card-activity7.js等）
- 删除server/scripts目录及其内容
- 删除server/customerH5目录
- 删除server/API_ENDPOINTS_ANALYSIS.md文档
- 更新.gitignore排除archives目录

**版本更新**：
- 更新后端版本号：R1.0.0 → R1.1.0
- 更新管理后台版本号：R1.0.0 → R1.1.0
- 更新H5前端版本号：R1.0.0 → R1.1.0
- 更新部署文档中的版本信息

**部署优化**：
- 更新所有部署文档至R1.1.0版本
- 清理项目结构，移除历史版本文件
- 优化部署包结构

### R1.0.0 (2026-02-19)

**新增功能**：
- 会员等级系统：支持自动升级和手动调整
- 活动游戏功能：支持大转盘、老虎机、刮刮乐、盲盒、九宫格
- H5抽奖功能：支持免费次数和积分消耗
- 产品管理：完整的CRUD操作
- 订单管理：订单创建、状态更新、会员等级计算
- 活动管理：活动创建、游戏配置、奖品管理
- 客户管理：客户信息、积分、消费额管理
- 会员等级变更日志：完整追踪等级变更历史

**技术改进**：
- 修复decimal类型转换问题
- 优化数据库查询性能
- 完善错误处理机制
- 添加自动化部署脚本
- 提供完整的环境配置模板

**测试完成**：
- 产品管理功能测试
- 订单管理功能测试
- 活动管理功能测试
- 会员等级自动升级功能测试
- H5活动页面和抽奖功能测试
- H5订单查询功能测试
- 活动游戏功能测试

---

## 🎯 部署检查清单

在部署到生产环境前，请确认以下项目：

### 安全检查
- [ ] 已修改默认管理员密码
- [ ] 已修改默认JWT密钥
- [ ] 已修改数据库密码
- [ ] 已配置防火墙规则
- [ ] 已启用SSL证书（生产环境）

### 功能检查
- [ ] 数据库连接正常
- [ ] 后端服务运行正常
- [ ] 管理后台可以访问
- [ ] H5前端可以访问
- [ ] API接口响应正常
- [ ] 文件上传功能正常
- [ ] 用户注册和登录正常

### 性能检查
- [ ] 页面加载速度正常
- [ ] API响应时间正常
- [ ] 数据库查询性能正常
- [ ] 服务器资源使用正常

### 备份检查
- [ ] 已配置数据库自动备份
- [ ] 已配置应用日志备份
- [ ] 已测试备份恢复流程

---

**部署完成后，请立即进行完整的功能测试！**

**祝部署顺利！🚀**
