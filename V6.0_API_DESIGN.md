# V6.0 APIè®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç‰ˆæœ¬ | V1.0 |
| åˆ›å»ºæ—¥æœŸ | 2026-02-26 |
| åˆ›å»ºäºº | å¼€å‘å›¢é˜Ÿ |
| çŠ¶æ€ | è‰ç¨¿ |

---

## 1. APIæ¦‚è¿°

### 1.1 åŸºç¡€ä¿¡æ¯
- **APIåŸºç¡€è·¯å¾„**: /api/v6
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

### 1.2 é€šç”¨å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "é”™è¯¯ä¿¡æ¯"
  },
  "timestamp": "2026-02-26T10:00:00Z"
}
```

#### åˆ†é¡µå“åº”
```json
{
  "success": true,
  "data": {
    "items": [],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

### 1.3 HTTPçŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### 1.4 é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| LEAD_001 | çº¿ç´¢ä¸å­˜åœ¨ |
| LEAD_002 | çº¿ç´¢å·²åˆ é™¤ |
| LEAD_003 | çº¿ç´¢å·²è½¬åŒ– |
| LEAD_004 | çº¿ç´¢å·²å…³é—­ |
| LEAD_005 | çº¿ç´¢å·²åˆ†é… |
| LEAD_006 | çº¿ç´¢å‚æ•°é”™è¯¯ |
| LEAD_007 | çº¿ç´¢åˆ›å»ºå¤±è´¥ |
| LEAD_008 | çº¿ç´¢æ›´æ–°å¤±è´¥ |
| LEAD_009 | çº¿ç´¢åˆ é™¤å¤±è´¥ |
| LEAD_010 | çº¿ç´¢å¯¼å…¥å¤±è´¥ |

---

## 2. çº¿ç´¢ç®¡ç†API

### 2.1 åˆ›å»ºçº¿ç´¢

**æ¥å£æè¿°**: åˆ›å»ºæ–°çš„é”€å”®çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "å¼ ä¸‰",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "company": "æŸæŸå…¬å¸",
  "position": "ç»ç†",
  "source": "website",
  "source_detail": "å®˜ç½‘è¡¨å•",
  "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
  "priority": "high",
  "assigned_to": 1
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| name | String | æ˜¯ | çº¿ç´¢å§“åï¼Œæœ€å¤š100å­—ç¬¦ |
| phone | String | æ˜¯ | ç”µè¯å·ç ï¼Œæœ€å¤š20å­—ç¬¦ |
| email | String | å¦ | é‚®ç®±åœ°å€ï¼Œæœ€å¤š100å­—ç¬¦ |
| company | String | å¦ | å…¬å¸åç§°ï¼Œæœ€å¤š200å­—ç¬¦ |
| position | String | å¦ | èŒä½ï¼Œæœ€å¤š100å­—ç¬¦ |
| source | String | æ˜¯ | æ¥æºæ¸ é“ï¼ˆwebsiteã€phoneã€exhibitionã€referralã€otherï¼‰ |
| source_detail | String | å¦ | æ¥æºè¯¦æƒ…ï¼Œæœ€å¤š200å­—ç¬¦ |
| description | String | å¦ | çº¿ç´¢æè¿°ï¼Œæœ€å¤š2000å­—ç¬¦ |
| priority | String | å¦ | ä¼˜å…ˆçº§ï¼ˆhighã€mediumã€lowï¼‰ï¼Œé»˜è®¤medium |
| assigned_to | Number | å¦ | åˆ†é…ç»™çš„é”€å”®äººå‘˜ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "company": "æŸæŸå…¬å¸",
    "position": "ç»ç†",
    "source": "website",
    "source_detail": "å®˜ç½‘è¡¨å•",
    "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
    "priority": "high",
    "status": "new",
    "assigned_to": 1,
    "assigned_at": null,
    "score": 0,
    "converted": false,
    "converted_at": null,
    "converted_amount": null,
    "converted_customer_id": null,
    "closed": false,
    "closed_at": null,
    "close_reason": null,
    "created_by": 1,
    "created_at": "2026-02-26T10:00:00Z",
    "updated_at": "2026-02-26T10:00:00Z"
  },
  "message": "çº¿ç´¢åˆ›å»ºæˆåŠŸ",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

### 2.2 è·å–çº¿ç´¢åˆ—è¡¨

**æ¥å£æè¿°**: è·å–çº¿ç´¢åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æœç´¢ã€æ’åº

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | Number | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| pageSize | Number | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100 |
| status | String | å¦ | çŠ¶æ€ç­›é€‰ï¼ˆnewã€assignedã€contactingã€interestedã€convertedã€closedï¼‰ |
| priority | String | å¦ | ä¼˜å…ˆçº§ç­›é€‰ï¼ˆhighã€mediumã€lowï¼‰ |
| source | String | å¦ | æ¥æºç­›é€‰ï¼ˆwebsiteã€phoneã€exhibitionã€referralã€otherï¼‰ |
| assigned_to | Number | å¦ | åˆ†é…äººç­›é€‰ |
| keyword | String | å¦ | å…³é”®è¯æœç´¢ï¼ˆå§“åã€ç”µè¯ã€å…¬å¸ï¼‰ |
| startDate | String | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| sortBy | String | å¦ | æ’åºå­—æ®µï¼ˆcreated_atã€updated_atã€priorityã€scoreï¼‰ï¼Œé»˜è®¤created_at |
| sortOrder | String | å¦ | æ’åºæ–¹å‘ï¼ˆascã€descï¼‰ï¼Œé»˜è®¤desc |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "name": "å¼ ä¸‰",
        "phone": "13800138000",
        "email": "zhangsan@example.com",
        "company": "æŸæŸå…¬å¸",
        "position": "ç»ç†",
        "source": "website",
        "source_detail": "å®˜ç½‘è¡¨å•",
        "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
        "priority": "high",
        "status": "new",
        "assigned_to": 1,
        "assigned_at": null,
        "score": 0,
        "converted": false,
        "converted_at": null,
        "converted_amount": null,
        "converted_customer_id": null,
        "closed": false,
        "closed_at": null,
        "close_reason": null,
        "created_by": 1,
        "created_at": "2026-02-26T10:00:00Z",
        "updated_at": "2026-02-26T10:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

### 2.3 è·å–çº¿ç´¢è¯¦æƒ…

**æ¥å£æè¿°**: è·å–æŒ‡å®šçº¿ç´¢çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/:id
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "company": "æŸæŸå…¬å¸",
    "position": "ç»ç†",
    "source": "website",
    "source_detail": "å®˜ç½‘è¡¨å•",
    "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
    "priority": "high",
    "status": "new",
    "assigned_to": 1,
    "assigned_at": null,
    "score": 0,
    "converted": false,
    "converted_at": null,
    "converted_amount": null,
    "converted_customer_id": null,
    "closed": false,
    "closed_at": null,
    "close_reason": null,
    "created_by": 1,
    "created_at": "2026-02-26T10:00:00Z",
    "updated_at": "2026-02-26T10:00:00Z",
    "assigned_to_user": {
      "id": 1,
      "username": "admin",
      "name": "ç®¡ç†å‘˜"
    },
    "created_by_user": {
      "id": 1,
      "username": "admin",
      "name": "ç®¡ç†å‘˜"
    }
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

### 2.4 æ›´æ–°çº¿ç´¢

**æ¥å£æè¿°**: æ›´æ–°æŒ‡å®šçº¿ç´¢çš„ä¿¡æ¯

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: PUT
- **è·¯å¾„**: /api/v6/leads/:id
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "å¼ ä¸‰",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "company": "æŸæŸå…¬å¸",
  "position": "ç»ç†",
  "source": "website",
  "source_detail": "å®˜ç½‘è¡¨å•",
  "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
  "priority": "high",
  "status": "assigned",
  "score": 80
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| name | String | å¦ | çº¿ç´¢å§“åï¼Œæœ€å¤š100å­—ç¬¦ |
| phone | String | å¦ | ç”µè¯å·ç ï¼Œæœ€å¤š20å­—ç¬¦ |
| email | String | å¦ | é‚®ç®±åœ°å€ï¼Œæœ€å¤š100å­—ç¬¦ |
| company | String | å¦ | å…¬å¸åç§°ï¼Œæœ€å¤š200å­—ç¬¦ |
| position | String | å¦ | èŒä½ï¼Œæœ€å¤š100å­—ç¬¦ |
| source | String | å¦ | æ¥æºæ¸ é“ï¼ˆwebsiteã€phoneã€exhibitionã€referralã€otherï¼‰ |
| source_detail | String | å¦ | æ¥æºè¯¦æƒ…ï¼Œæœ€å¤š200å­—ç¬¦ |
| description | String | å¦ | çº¿ç´¢æè¿°ï¼Œæœ€å¤š2000å­—ç¬¦ |
| priority | String | å¦ | ä¼˜å…ˆçº§ï¼ˆhighã€mediumã€lowï¼‰ |
| status | String | å¦ | çŠ¶æ€ï¼ˆnewã€assignedã€contactingã€interestedã€convertedã€closedï¼‰ |
| score | Number | å¦ | çº¿ç´¢è¯„åˆ†ï¼ˆ0-100ï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "company": "æŸæŸå…¬å¸",
    "position": "ç»ç†",
    "source": "website",
    "source_detail": "å®˜ç½‘è¡¨å•",
    "description": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“æ„Ÿå…´è¶£",
    "priority": "high",
    "status": "assigned",
    "assigned_to": 1,
    "assigned_at": null,
    "score": 80,
    "converted": false,
    "converted_at": null,
    "converted_amount": null,
    "converted_customer_id": null,
    "closed": false,
    "closed_at": null,
    "close_reason": null,
    "created_by": 1,
    "created_at": "2026-02-26T10:00:00Z",
    "updated_at": "2026-02-26T10:05:00Z"
  },
  "message": "çº¿ç´¢æ›´æ–°æˆåŠŸ",
  "timestamp": "2026-02-26T10:05:00Z"
}
```

### 2.5 åˆ é™¤çº¿ç´¢

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šçº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: DELETE
- **è·¯å¾„**: /api/v6/leads/:id
- **æƒé™**: ç®¡ç†å‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": null,
  "message": "çº¿ç´¢åˆ é™¤æˆåŠŸ",
  "timestamp": "2026-02-26T10:10:00Z"
}
```

### 2.6 æ‰¹é‡åˆ é™¤çº¿ç´¢

**æ¥å£æè¿°**: æ‰¹é‡åˆ é™¤çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: DELETE
- **è·¯å¾„**: /api/v6/leads/batch
- **æƒé™**: ç®¡ç†å‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "ids": [1, 2, 3]
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| ids | Array | æ˜¯ | çº¿ç´¢IDæ•°ç»„ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "deletedCount": 3
  },
  "message": "æ‰¹é‡åˆ é™¤æˆåŠŸ",
  "timestamp": "2026-02-26T10:15:00Z"
}
```

---

## 3. çº¿ç´¢å¯¼å…¥API

### 3.1 æ‰¹é‡å¯¼å…¥çº¿ç´¢

**æ¥å£æè¿°**: é€šè¿‡Excelæˆ–CSVæ–‡ä»¶æ‰¹é‡å¯¼å…¥çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/import
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡
- **Content-Type**: multipart/form-data

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | å¯¼å…¥æ–‡ä»¶ï¼ˆExcelæˆ–CSVï¼‰ |
| assigned_to | Number | å¦ | é»˜è®¤åˆ†é…ç»™çš„é”€å”®äººå‘˜ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "totalCount": 100,
    "successCount": 95,
    "failedCount": 5,
    "failedItems": [
      {
        "row": 3,
        "reason": "ç”µè¯å·ç æ ¼å¼é”™è¯¯"
      },
      {
        "row": 7,
        "reason": "å§“åä¸èƒ½ä¸ºç©º"
      }
    ]
  },
  "message": "å¯¼å…¥å®Œæˆ",
  "timestamp": "2026-02-26T10:20:00Z"
}
```

### 3.2 ä¸‹è½½å¯¼å…¥æ¨¡æ¿

**æ¥å£æè¿°**: ä¸‹è½½çº¿ç´¢å¯¼å…¥æ¨¡æ¿

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/import/template
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**å“åº”**: æ–‡ä»¶æµï¼ˆExcelæ–‡ä»¶ï¼‰

---

## 4. çº¿ç´¢åˆ†é…API

### 4.1 åˆ†é…çº¿ç´¢

**æ¥å£æè¿°**: å°†çº¿ç´¢åˆ†é…ç»™é”€å”®äººå‘˜

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/:id/assign
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**è¯·æ±‚å‚æ•°**:
```json
{
  "assigned_to": 2,
  "notes": "é«˜ä¼˜å…ˆçº§çº¿ç´¢ï¼Œä¼˜å…ˆå¤„ç†"
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| assigned_to | Number | æ˜¯ | åˆ†é…ç»™çš„é”€å”®äººå‘˜ID |
| notes | String | å¦ | åˆ†é…å¤‡æ³¨ï¼Œæœ€å¤š500å­—ç¬¦ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "assigned_to": 2,
    "assigned_at": "2026-02-26T10:25:00Z",
    "status": "assigned"
  },
  "message": "çº¿ç´¢åˆ†é…æˆåŠŸ",
  "timestamp": "2026-02-26T10:25:00Z"
}
```

### 4.2 æ‰¹é‡åˆ†é…çº¿ç´¢

**æ¥å£æè¿°**: æ‰¹é‡åˆ†é…çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/batch-assign
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡

**è¯·æ±‚å‚æ•°**:
```json
{
  "ids": [1, 2, 3],
  "assigned_to": 2,
  "notes": "æ‰¹é‡åˆ†é…"
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| ids | Array | æ˜¯ | çº¿ç´¢IDæ•°ç»„ |
| assigned_to | Number | æ˜¯ | åˆ†é…ç»™çš„é”€å”®äººå‘˜ID |
| notes | String | å¦ | åˆ†é…å¤‡æ³¨ï¼Œæœ€å¤š500å­—ç¬¦ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "assignedCount": 3
  },
  "message": "æ‰¹é‡åˆ†é…æˆåŠŸ",
  "timestamp": "2026-02-26T10:30:00Z"
}
```

### 4.3 è‡ªåŠ¨åˆ†é…çº¿ç´¢

**æ¥å£æè¿°**: æ ¹æ®è§„åˆ™è‡ªåŠ¨åˆ†é…çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/auto-assign
- **æƒé™**: ç®¡ç†å‘˜

**è¯·æ±‚å‚æ•°**:
```json
{
  "rule": "round_robin",
  "filters": {
    "status": "new",
    "priority": "high"
  }
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| rule | String | æ˜¯ | åˆ†é…è§„åˆ™ï¼ˆround_robinã€load_balanceã€regionï¼‰ |
| filters | Object | å¦ | ç­›é€‰æ¡ä»¶ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "assignedCount": 10,
    "details": [
      {
        "leadId": 1,
        "assignedTo": 2,
        "assignedAt": "2026-02-26T10:35:00Z"
      }
    ]
  },
  "message": "è‡ªåŠ¨åˆ†é…æˆåŠŸ",
  "timestamp": "2026-02-26T10:35:00Z"
}
```

### 4.4 è·å–çº¿ç´¢åˆ†é…å†å²

**æ¥å£æè¿°**: è·å–çº¿ç´¢çš„åˆ†é…å†å²

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/:id/assignments
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "lead_id": 1,
      "assigned_to": 2,
      "assigned_by": 1,
      "assigned_at": "2026-02-26T10:25:00Z",
      "notes": "é«˜ä¼˜å…ˆçº§çº¿ç´¢ï¼Œä¼˜å…ˆå¤„ç†",
      "assigned_to_user": {
        "id": 2,
        "username": "sales1",
        "name": "é”€å”®å‘˜1"
      },
      "assigned_by_user": {
        "id": 1,
        "username": "admin",
        "name": "ç®¡ç†å‘˜"
      }
    }
  ],
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:40:00Z"
}
```

---

## 5. çº¿ç´¢è·Ÿè¿›API

### 5.1 æ·»åŠ è·Ÿè¿›è®°å½•

**æ¥å£æè¿°**: ä¸ºçº¿ç´¢æ·»åŠ è·Ÿè¿›è®°å½•

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/:id/followups
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**è¯·æ±‚å‚æ•°**:
```json
{
  "contact_method": "phone",
  "contact_time": "2026-02-26T10:45:00Z",
  "contact_content": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“å¾ˆæ„Ÿå…´è¶£ï¼Œéœ€è¦è¿›ä¸€æ­¥æ²Ÿé€š",
  "contact_result": "success",
  "next_followup": "2026-02-27T10:00:00Z"
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| contact_method | String | æ˜¯ | è”ç³»æ–¹å¼ï¼ˆphoneã€emailã€smsã€meetingï¼‰ |
| contact_time | String | æ˜¯ | è”ç³»æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| contact_content | String | å¦ | è”ç³»å†…å®¹ï¼Œæœ€å¤š2000å­—ç¬¦ |
| contact_result | String | æ˜¯ | è”ç³»ç»“æœï¼ˆsuccessã€failedã€pendingï¼‰ |
| next_followup | String | å¦ | ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "lead_id": 1,
    "contact_method": "phone",
    "contact_time": "2026-02-26T10:45:00Z",
    "contact_content": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“å¾ˆæ„Ÿå…´è¶£ï¼Œéœ€è¦è¿›ä¸€æ­¥æ²Ÿé€š",
    "contact_result": "success",
    "next_followup": "2026-02-27T10:00:00Z",
    "attachment": null,
    "created_by": 1,
    "created_at": "2026-02-26T10:45:00Z"
  },
  "message": "è·Ÿè¿›è®°å½•æ·»åŠ æˆåŠŸ",
  "timestamp": "2026-02-26T10:45:00Z"
}
```

### 5.2 è·å–çº¿ç´¢è·Ÿè¿›è®°å½•

**æ¥å£æè¿°**: è·å–çº¿ç´¢çš„è·Ÿè¿›è®°å½•åˆ—è¡¨

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/:id/followups
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "lead_id": 1,
      "contact_method": "phone",
      "contact_time": "2026-02-26T10:45:00Z",
      "contact_content": "å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“å¾ˆæ„Ÿå…´è¶£ï¼Œéœ€è¦è¿›ä¸€æ­¥æ²Ÿé€š",
      "contact_result": "success",
      "next_followup": "2026-02-27T10:00:00Z",
      "attachment": null,
      "created_by": 1,
      "created_at": "2026-02-26T10:45:00Z",
      "created_by_user": {
        "id": 1,
        "username": "admin",
        "name": "ç®¡ç†å‘˜"
      }
    }
  ],
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T10:50:00Z"
}
```

---

## 6. çº¿ç´¢è½¬åŒ–API

### 6.1 è½¬åŒ–çº¿ç´¢

**æ¥å£æè¿°**: å°†çº¿ç´¢è½¬åŒ–ä¸ºå®¢æˆ·

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/:id/convert
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**è¯·æ±‚å‚æ•°**:
```json
{
  "converted_amount": 10000.00,
  "converted_at": "2026-02-26T11:00:00Z",
  "notes": "å®¢æˆ·ç­¾è®¢äº†åˆåŒ"
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| converted_amount | Number | æ˜¯ | è½¬åŒ–é‡‘é¢ |
| converted_at | String | æ˜¯ | è½¬åŒ–æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| notes | String | å¦ | è½¬åŒ–å¤‡æ³¨ï¼Œæœ€å¤š500å­—ç¬¦ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "lead_id": 1,
    "customer_id": 1,
    "converted": true,
    "converted_at": "2026-02-26T11:00:00Z",
    "converted_amount": 10000.00,
    "converted_customer_id": 1
  },
  "message": "çº¿ç´¢è½¬åŒ–æˆåŠŸ",
  "timestamp": "2026-02-26T11:00:00Z"
}
```

### 6.2 å…³é—­çº¿ç´¢

**æ¥å£æè¿°**: å…³é—­çº¿ç´¢

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: POST
- **è·¯å¾„**: /api/v6/leads/:id/close
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | Number | æ˜¯ | çº¿ç´¢ID |

**è¯·æ±‚å‚æ•°**:
```json
{
  "close_reason": "å®¢æˆ·æ²¡æœ‰æ„å‘",
  "closed_at": "2026-02-26T11:05:00Z"
}
```

**å‚æ•°è¯´æ˜**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| close_reason | String | æ˜¯ | å…³é—­åŸå› ï¼Œæœ€å¤š200å­—ç¬¦ |
| closed_at | String | å¦ | å…³é—­æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ï¼Œé»˜è®¤å½“å‰æ—¶é—´ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "closed": true,
    "closed_at": "2026-02-26T11:05:00Z",
    "close_reason": "å®¢æˆ·æ²¡æœ‰æ„å‘",
    "status": "closed"
  },
  "message": "çº¿ç´¢å…³é—­æˆåŠŸ",
  "timestamp": "2026-02-26T11:05:00Z"
}
```

---

## 7. çº¿ç´¢ç»Ÿè®¡API

### 7.1 è·å–çº¿ç´¢ç»Ÿè®¡

**æ¥å£æè¿°**: è·å–çº¿ç´¢ç»Ÿè®¡æ•°æ®

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/statistics
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| startDate | String | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| assigned_to | Number | å¦ | åˆ†é…äººç­›é€‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "total": 100,
    "new": 20,
    "assigned": 30,
    "contacting": 25,
    "interested": 15,
    "converted": 8,
    "closed": 2,
    "conversionRate": 8.0,
    "avgConversionDays": 15.5
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T11:10:00Z"
}
```

### 7.2 è·å–çº¿ç´¢è¶‹åŠ¿

**æ¥å£æè¿°**: è·å–çº¿ç´¢è¶‹åŠ¿æ•°æ®

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/trends
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| period | String | å¦ | æ—¶é—´å‘¨æœŸï¼ˆdayã€weekã€monthã€yearï¼‰ï¼Œé»˜è®¤day |
| startDate | String | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "date": "2026-02-20",
      "total": 10,
      "converted": 1
    },
    {
      "date": "2026-02-21",
      "total": 15,
      "converted": 2
    }
  ],
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T11:15:00Z"
}
```

### 7.3 è·å–çº¿ç´¢æ¥æºåˆ†æ

**æ¥å£æè¿°**: è·å–çº¿ç´¢æ¥æºåˆ†ææ•°æ®

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/source-analysis
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡ã€é”€å”®äººå‘˜

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| startDate | String | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "source": "website",
      "count": 50,
      "percentage": 50.0,
      "converted": 5,
      "conversionRate": 10.0
    },
    {
      "source": "phone",
      "count": 30,
      "percentage": 30.0,
      "converted": 2,
      "conversionRate": 6.7
    }
  ],
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T11:20:00Z"
}
```

### 7.4 è·å–é”€å”®äººå‘˜åˆ†æ

**æ¥å£æè¿°**: è·å–é”€å”®äººå‘˜åˆ†ææ•°æ®

**è¯·æ±‚ä¿¡æ¯**:
- **æ–¹æ³•**: GET
- **è·¯å¾„**: /api/v6/leads/salesperson-analysis
- **æƒé™**: ç®¡ç†å‘˜ã€é”€å”®ä¸»ç®¡

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| startDate | String | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| endDate | String | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "userId": 2,
      "username": "sales1",
      "name": "é”€å”®å‘˜1",
      "totalLeads": 50,
      "convertedLeads": 5,
      "conversionRate": 10.0,
      "totalAmount": 50000.00,
      "avgConversionDays": 12.0
    }
  ],
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2026-02-26T11:25:00Z"
}
```

---

## 8. é™„å½•

### 8.1 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| V1.0 | 2026-02-26 | åˆå§‹ç‰ˆæœ¬ | å¼€å‘å›¢é˜Ÿ |

### 8.2 å‚è€ƒæ–‡æ¡£
- V6.0é”€å”®çº¿ç´¢ç®¡ç†éœ€æ±‚æ–‡æ¡£
- V6.0æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- RESTful APIè®¾è®¡è§„èŒƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-26  
**æœ€åæ›´æ–°**: 2026-02-26  
**çŠ¶æ€**: è‰ç¨¿
