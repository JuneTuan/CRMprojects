# V6.0 éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬å·**: V6.0
- **å‘å¸ƒæ—¥æœŸ**: 2026-02-28
- **Gitåˆ†æ”¯**: `v6-release`

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+
- Git

### 2. å…‹éš†ä»£ç 

```bash
git clone https://github.com/JuneTuan/CRMprojects.git
cd CRMprojects
git checkout v6-release
```

### 3. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=your_root_password
MYSQL_DATABASE=crm_db
MYSQL_USER=crm_user
MYSQL_PASSWORD=your_password

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRATION=7d

# CORSé…ç½®
CORS_ORIGIN=http://localhost:80,http://localhost:5173,http://localhost:8080,http://localhost:8081
```

### 4. æ•°æ®åº“åˆå§‹åŒ–

æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼š

```bash
# è¿›å…¥MySQLå®¹å™¨
docker-compose exec mysql mysql -u root -p

# æ‰§è¡Œè¿ç§»è„šæœ¬
source /docker-entrypoint-initdb.d/V6.0_DATABASE_MIGRATION.sql
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 6. è®¿é—®æœåŠ¡

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| ç®¡ç†åå° | http://localhost:8080 | ç®¡ç†å‘˜ä½¿ç”¨ |
| H5å‰ç«¯ | http://localhost:8081 | å®¢æˆ·ä½¿ç”¨ |
| åç«¯API | http://localhost:3001 | APIæ¥å£ |
| MySQL | localhost:3306 | æ•°æ®åº“ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
CRMprojects/
â”œâ”€â”€ docker-compose.yml              # Dockerç¼–æ’é…ç½®
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ V6.0_DATABASE_MIGRATION.sql     # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ V6.0_DEPLOYMENT_GUIDE.md        # éƒ¨ç½²æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ README.md                       # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ admin-web/                      # ç®¡ç†åå°
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ dist/                       # æ„å»ºäº§ç‰©
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ customerH5/                     # H5å‰ç«¯
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ dist/build/h5/              # æ„å»ºäº§ç‰©
â”œâ”€â”€ server/                         # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ dist/                       # æ„å»ºäº§ç‰©
â””â”€â”€ database/                       # æ•°æ®åº“è„šæœ¬
    â””â”€â”€ init/
        â””â”€â”€ 01-init-database.sql    # åˆå§‹åŒ–è„šæœ¬
```

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²

### åç«¯éƒ¨ç½²

```bash
cd server
npm install
npm run build
npm run start:prod
```

### ç®¡ç†åå°éƒ¨ç½²

```bash
cd admin-web
npm install
npm run build
# å°†distç›®å½•éƒ¨ç½²åˆ°nginx
```

### H5éƒ¨ç½²

```bash
cd customerH5
npm install
npm run build:h5
# å°†dist/build/h5ç›®å½•éƒ¨ç½²åˆ°nginx
```

## ğŸ“ é…ç½®è¯´æ˜

### Nginxé…ç½®

ç®¡ç†åå°å’ŒH5éƒ½ä½¿ç”¨Nginxä½œä¸ºé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œé…ç½®ç¤ºä¾‹ï¼š

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://server:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ”’ å®‰å…¨é…ç½®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. **JWTå¯†é’¥**: ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ä½œä¸ºJWT_SECRET
3. **CORSé…ç½®**: é™åˆ¶å…è®¸çš„åŸŸå
4. **æ•°æ®åº“**: ç¦æ­¢rootè¿œç¨‹ç™»å½•ï¼Œä½¿ç”¨ä¸“ç”¨è´¦å·

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs server
docker-compose logs admin-web
docker-compose logs customer-h5
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLçŠ¶æ€
docker-compose exec mysql mysql -u crm_user -p -e "SELECT 1"

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker-compose exec server ping mysql
```

### ç«¯å£å†²çª

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3001
lsof -i :8080
lsof -i :8081
lsof -i :3306
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### å¤‡ä»½æ•°æ®åº“

```bash
# æ‰‹åŠ¨å¤‡ä»½
docker-compose exec mysql mysqldump -u root -p crm_db > backup_$(date +%Y%m%d_%H%M%S).sql

# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
0 2 * * * cd /path/to/CRMprojects && docker-compose exec -T mysql mysqldump -u root -pPASSWORD crm_db > backups/crm_db_$(date +\%Y\%m\%d).sql
```

### æ›´æ–°éƒ¨ç½²

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin v6-release

# é‡æ–°æ„å»º
docker-compose down
docker-compose up -d --build

# æ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœ‰æ›´æ–°ï¼‰
docker-compose exec mysql mysql -u root -p crm_db < V6.0_DATABASE_MIGRATION.sql
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **GitHub Issues**: https://github.com/JuneTuan/CRMprojects/issues
- **æ–‡æ¡£åœ°å€**: https://github.com/JuneTuan/CRMprojects/tree/v6-release/docs

## ğŸ“„ è®¸å¯è¯

MIT License
